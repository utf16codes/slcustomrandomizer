<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap"
        rel="stylesheet">

    <title>SL Custom Match Randomizer</title>

    <style>
        body {
            background-image: url(images/background.jpg);
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
            background-size: cover;

            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;

            font-family: 'Lato', sans-serif;
            color: white;
        }

        label {
            color: #dbe0e9;
            white-space: pre;
        }

        input {
            font-size: 1em;
            width: 18em;
            font-family: 'Lato', sans-serif;
        }

        button {
            font-size: 0.8em;
            background-color: #354b97;
            border: none;
            padding: 5px 16px 0 16px;
            margin: 8px;
            border-radius: 5px;
            /* box-shadow: 0px 0 0px 4px #1f6fd5; */
        }

        button>svg {
            width: 1.7em;
        }

        button:hover {
            background-color: #162a53;
        }

        button:active {
            background-color: #dbe0e9;
        }

        .main {
            background-color: rgb(0, 0, 0, 0.4);
            margin: 50px 0;
            width: 100%;
        }

        .header {
            background: linear-gradient(to right, #0c1032, #242b6a, #353f9d, #242b6a, #0c1032);
            height: 5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header>h1 {
            size: 4em;
            font-weight: 600;
            font-style: italic;
            margin: auto;
            text-align: center;
            color: #c2daf9;
            text-shadow: 0px 4px 4px rgba(0, 0, 0, 0.6);
        }

        .player-submit-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 4em;
            font-size: 1.5em;
        }

        .all-teams {
            padding: 0 20px;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: center;
            column-gap: 50px;
        }

        .team-cards {
            flex-grow: 1;
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            justify-content: center;
            align-items: center;
            column-gap: 20px;
        }

        .player-card {
            background-color: #162a53;
            border-radius: 5px;
            border: 4px solid #61cfff;
            box-shadow: 0px 0 0px 4px #1f6fd5;
            width: 200px;
            flex-grow: 0;
        }

        .legend-image-container {
            padding: 4px 4px 0 4px;
        }

        .legend-image-container>img {
            width: 100%;
            border-radius: 5px;
        }

        .player-name-container {
            background-color: #224076;
            border-radius: 0 0 5px 5px;
            height: 4em;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }

        .player-name {
            margin: 0.5rem;
            font-weight: 900;
            text-align: center;
            font-size: 1.4rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #dbe0e9;
        }

        .footer {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 100px 0 0 0;
        }

        .credits {
            text-align: center;
            color: rgba(219, 224, 237, 0.2);
        }
    </style>
</head>

<body>
    <div class="main">
        <div class="header">
            <h1>SL CUSTOM MATCH RANDOMIZER</h1>
        </div>

        <div class="player-submit-container">
            <label for="name">Players: </label>
            <input type="text" id="player-names" placeholder="enter comma separated names here">
            <button onclick="randomizeEverything()">
                <svg fill="#cfdfff" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="48">
                    <path
                        d="M196-305q-28-40-39.5-83.5T145-480q0-136 98.5-234.5T476-813h43l-69-70 45-45 160 160-160 160-46-45 69-69h-39q-99 0-171 72t-72 170q0 32 6.5 60.5T260-369l-64 64ZM464-29 304-189l160-162 45 47-70 69h43q98 1 170-71t72-172q0-31-6.5-59.5T699-589l65-64q27 43 39 86t12 89q0 137-98.5 236.5T485-143h-46l70 70-45 44Z" />
                </svg>
            </button>
        </div>

        <div class="all-teams">
            <div class="team-cards" id="team-cards-0">
                <div class="player-card" id="player-card-0" onclick="randomizeSelectPlayer(this)">
                    <div class="legend-image-container">
                        <img class="Maya">
                    </div>
                    <div class="player-name-container">
                        <p class="player-name">utf16</p>
                    </div>
                </div>
                <div class="player-card" id="player-card-1" onclick="randomizeSelectPlayer(this)">
                    <div class="legend-image-container">
                        <img class="Molly">
                    </div>
                    <div class="player-name-container">
                        <p class="player-name">xanderp</p>
                    </div>
                </div>
                <div class="player-card" id="player-card-2" onclick="randomizeSelectPlayer(this)">
                    <div class="legend-image-container">
                        <img class="Zeppetta">
                    </div>
                    <div class="player-name-container">
                        <p class="player-name">heavenly</p>
                    </div>
                </div>
            </div>

            <div class="team-cards" id="team-cards-1">
                <div class="player-card" id="player-card-3" onclick="randomizeSelectPlayer(this)">
                    <div class="legend-image-container">
                        <img class="Alice">
                    </div>
                    <div class="player-name-container">
                        <p class="player-name">myuki</p>
                    </div>
                </div>
                <div class="player-card" id="player-card-4" onclick="randomizeSelectPlayer(this)">
                    <div class="legend-image-container">
                        <img class="Red">
                    </div>
                    <div class="player-name-container">
                        <p class="player-name">saturn</p>
                    </div>
                </div>
                <div class="player-card" id="player-card-5" onclick="randomizeSelectPlayer(this)">
                    <div class="legend-image-container">
                        <img class="Rambert">
                    </div>
                    <div class="player-name-container">
                        <p class="player-name">saitama</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p class="credits">by utf16 (NUT | TDR), v1.0</p>
        </div>
    </div>

    <script>
        // EMBED SETUPS HERE    
        const LEGEND_PICS = {
            "Ali": "images/portrait/Ali.png",
            "Alice": "images/portrait/Alice.png",
            "Aoi": "images/portrait/Aoi.png",
            "Briar": "images/portrait/Briar.png",
            "Brick": "images/portrait/Brick.png",
            "Cindy": "images/portrait/Cindy.png",
            "DonQuixote": "images/portrait/DonQuixote.png",
            "Ducky": "images/portrait/Ducky.png",
            "Flare": "images/portrait/Flare.png",
            "Goldie": "images/portrait/Goldie.png",
            "Gumi": "images/portrait/Gumi.png",
            "Hamelin": "images/portrait/Hamelin.png",
            "Hook": "images/portrait/Hook.png",
            "JackO": "images/portrait/JackO.png",
            "Javert": "images/portrait/Javert.png",
            "Kaiser": "images/portrait/Kaiser.png",
            "Kurenai": "images/portrait/Kurenai.png",
            "Lettuce": "images/portrait/Lettuce.png",
            "Loren": "images/portrait/Loren.png",
            "Marina": "images/portrait/Marina.png",
            "MasterCat": "images/portrait/MasterCat.png",
            "Maya": "images/portrait/Maya.png",
            "Molly": "images/portrait/Molly.png",
            "Narsha": "images/portrait/Narsha.png",
            "Nui": "images/portrait/Nui.png",
            "Octavia": "images/portrait/Octavia.png",
            "Parfait": "images/portrait/Parfait.png",
            "Peter": "images/portrait/Peter.png",
            "Pinocchio": "images/portrait/Pinocchio.png",
            "Proc": "images/portrait/Proc.png",
            "Rambert": "images/portrait/Rambert.png",
            "Rapunzel": "images/portrait/Rapunzel.png",
            "Ravi": "images/portrait/Ravi.png",
            "Red": "images/portrait/Red.png",
            "Robin": "images/portrait/Robin.png",
            "Snow": "images/portrait/Snow.png",
            "Sol": "images/portrait/Sol.png",
            "Timun": "images/portrait/Timun.png",
            "Victor": "images/portrait/Victor.png",
            "WitchQueen": "images/portrait/WitchQueen.png",
            "Wolfgang": "images/portrait/Wolfgang.png",
            "Woochi": "images/portrait/Woochi.png",
            "Wukong": "images/portrait/Wukong.png",
            "YongYong": "images/portrait/YongYong.png",
            "Zeppetta": "images/portrait/Zeppetta.png",
        };

        // Get a random number, inclusive on both ends.
        function getRandomInt(min, max) {
            if (min > max) {
                throw new Error("Invalid range");
            } else if (min === max) {
                return min;
            }

            // Calculate the range and the number of bits needed
            var range = max - min + 1;
            var bitsNeeded = Math.ceil(Math.log2(range));

            // Calculate the byte length needed to hold the required number of bits
            var bytesNeeded = Math.ceil(bitsNeeded / 8);

            // Create a typed array to store the random values
            var randomBytes = new Uint8Array(bytesNeeded);

            // Generate cryptographically secure random values
            crypto.getRandomValues(randomBytes);

            // Convert the random bytes to a single number
            var randomValue = 0;
            for (var i = 0; i < bytesNeeded; i++) {
                randomValue = (randomValue << 8) + randomBytes[i];
            }

            // Calculate the final random number within the given range
            var randomNumber = min + (randomValue % range);
            return randomNumber;
        }

        function shuffleArray(array) {
            const copy = [...array];
            const shuffled = [];
            for (let i = 0; i < array.length; i++) {
                const index = getRandomInt(0, copy.length - 1);
                const [item] = copy.splice(index, 1);
                shuffled.push(item);
            }

            return shuffled;
        }

        function randomPick(array) {
            return array[getRandomInt(0, array.length - 1)]
        }

        function commaSeparatedTextToArray(text) {
            return text.split(",").map(e => e.trim()).filter(e => e.length != 0);
        }

        function populateAllLegendPictures() {
            for (let [name, pic] of Object.entries(LEGEND_PICS)) {
                for (let elem of document.getElementsByClassName(name)) {
                    elem.src = pic;
                }
            }
        }

        function randomizeEverything() {
            let players = commaSeparatedTextToArray(
                document.getElementById("player-names").value);

            // Unhide player-cards before we do anything.
            for (let e of document.getElementsByClassName("player-card")) {
                e.style.display = "block";
            }

            players = shuffleArray(players);
            let middleIx = Math.floor(players.length / 2);
            const team0 = players.slice(0, middleIx);
            const team1 = players.slice(middleIx);

            let team0CardIds = ["player-card-0", "player-card-1", "player-card-2"];
            for (let i = 0; i < team0CardIds.length; i++) {
                let playerCardId = team0CardIds[i];
                let playerName = team0[i];

                if (playerName != undefined) {
                    let playerNameElement =
                        document.querySelector(`#${playerCardId} .player-name`);
                    playerNameElement.textContent = playerName;

                    let legendPicElement =
                        document.querySelector(`#${playerCardId} .legend-image-container`)
                            .children[0];
                    legendPicElement.className = randomPick(Object.keys(LEGEND_PICS));
                } else {
                    let playerCardElement = document.getElementById(playerCardId);
                    playerCardElement.style.display = "none";
                }
            }

            let team1CardIds = ["player-card-3", "player-card-4", "player-card-5"];
            for (let i = 0; i < team1CardIds.length; i++) {
                let playerCardId = team1CardIds[i];
                let playerName = team1[i];

                if (playerName != undefined) {
                    let playerNameElement =
                        document.querySelector(`#${playerCardId} .player-name`);
                    playerNameElement.textContent = playerName;

                    let legendPicElement =
                        document.querySelector(`#${playerCardId} .legend-image-container`)
                            .children[0];
                    legendPicElement.className = randomPick(Object.keys(LEGEND_PICS));
                } else {
                    let playerCardElement = document.getElementById(playerCardId);
                    playerCardElement.style.display = "none";
                }
            }

            populateAllLegendPictures()
        }

        function randomizeSelectPlayer(playerCardElement) {
            let playerCardId = playerCardElement.id;
            let legendPicElement =
                document.querySelector(`#${playerCardId} .legend-image-container`)
                    .children[0];
            legendPicElement.className = randomPick(Object.keys(LEGEND_PICS));
            populateAllLegendPictures()
        }

        populateAllLegendPictures()
    </script>
</body>

</html>